apiVersion: installation.mattermost.com/v1beta1
kind: Mattermost
metadata:
  name: mattermost
  namespace: mattermost
spec:
  size: ${MATTERMOST_SIZE}
  replicas: ${MATTERMOST_REPLICAS}
  ingress:
    enabled: true
    host: ${DOMAIN}
  database:
    external:
      secret: mattermost-postgres
  fileStore:
    external:
      url: s3proxy.${S3PROXY_NAMESPACE}.svc.cluster.local
      bucket: ${S3PROXY_CONTAINER}
      secret: mattermost-secret-s3proxy
  licenseSecret: mattermost-secret-license
  image: mattermost/mattermost-enterprise-edition
  imagePullPolicy: IfNotPresent
  mattermostEnv:
  - name: MM_FILESETTINGS_AMAZONS3SSL
    value: "${MM_FILESETTINGS_AMAZONS3SSL}"
  - name: MM_FILESETTINGS_AMAZONS3SSE
    value: "${MM_FILESETTINGS_AMAZONS3SSE}"
  - name: MM_FILESETTINGS_AMAZONS3TRACE
    value: "${MM_FILESETTINGS_AMAZONS3TRACE}"
  - name: MM_SERVICEENVIRONMENT
    value: "${MM_SERVICEENVIRONMENT}"
  - name: MM_SQLSETTINGS_DATASOURCEREPLICAS
    valueFrom:
      secretKeyRef:
        name: mattermost-postgres
        key: DB_REPLICAS_CONNECTION_STRING
  version: ${MATTERMOST_VERSION}
  podTemplate:
    securityContext:
      fsGroup: 2000
